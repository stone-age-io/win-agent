# Windows Agent Configuration Example

# Agent Identity
device_id: "device-12345"  # Unique identifier for this agent

# NATS Subject Prefix (optional)
# All NATS subjects will use this prefix: {prefix}.{device_id}.{subject}
# Default: "agents" (results in: agents.device-12345.heartbeat, agents.device-12345.cmd.ping, etc.)
# Supports hierarchical prefixes with dots: "region.env.agents" or "production.us-east.agents"
# Each token (separated by dots) can contain: alphanumeric, dashes, underscores
# Max 50 characters total. No leading/trailing dots or consecutive dots.
subject_prefix: "agents"

# NATS Connection
nats:
  urls: 
    - "nats://connect.your-service.com:4222"
  
  # Authentication (choose one method)
  auth:
    # Option 1: Credentials file (RECOMMENDED for production)
    type: "creds"
    creds_file: "C:\\ProgramData\\WinAgent\\device.creds"
    
    # Option 2: Token authentication
    # type: "token"
    # token: "your-token-here"
    
    # Option 3: Username/Password authentication
    # type: "userpass"
    # username: "user"
    # password: "pass"
  
  # TLS Configuration (optional but recommended for production)
  tls:
    # Enable TLS encryption
    enabled: false
    
    # Client certificate and key for mutual TLS authentication (optional)
    # Required if server requires client certificates
    cert_file: "C:\\ProgramData\\WinAgent\\client-cert.pem"
    key_file: "C:\\ProgramData\\WinAgent\\client-key.pem"
    
    # CA certificate for server verification (optional)
    # If not provided, system CA pool is used
    ca_file: "C:\\ProgramData\\WinAgent\\ca-cert.pem"
    
    # Skip server certificate verification (NOT RECOMMENDED for production)
    # Only use this for development/testing with self-signed certificates
    insecure_skip_verify: false
  
  # Optional: Custom connection options
  max_reconnects: -1  # -1 = infinite retries
  reconnect_wait: "2s"
  drain_timeout: "30s"

# Scheduled Tasks
tasks:
  # Heartbeat - Periodic "I'm alive" message
  heartbeat:
    enabled: true
    interval: "1m"  # Every 1 minute
  
  # System Metrics - Scrape windows_exporter
  system_metrics:
    enabled: true
    interval: "5m"  # Every 5 minutes
    exporter_url: "http://localhost:9182/metrics"
  
  # Service Check - Monitor Windows services
  service_check:
    enabled: true
    interval: "1m"  # Every 1 minute
    services:  # List of services to monitor
      - "YourCriticalService"
      - "AnotherImportantService"
  
  # Inventory - System hardware/software inventory
  inventory:
    enabled: true
    interval: "24h"  # Daily (also runs on startup)

# Command Execution
commands:
  # Whitelist of services that can be controlled
  allowed_services:
    - "YourCriticalService"
    - "AnotherImportantService"
  
  # Whitelist of allowed PowerShell commands (exact match only)
  allowed_commands:
    - "Get-Process | Sort-Object CPU -Descending | Select-Object -First 5 Name,CPU,WS | ConvertTo-Json -Compress"
    - "Get-NetIPAddress"
    - "Get-EventLog -LogName Application -Newest 10"
  
  # Allowed log file paths (glob patterns supported)
  allowed_log_paths:
    - "C:\\Logs\\*.log"
    - "C:\\ProgramData\\YourApp\\*.log"
  
  # Command execution timeout
  timeout: "30s"

# Logging
logging:
  level: "info"  # debug, info, warn, error
  file: "C:\\ProgramData\\WinAgent\\agent.log"
  max_size_mb: 100
  max_backups: 3
